<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TMC Approval State Map</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #0f0f11;
      --bg-tertiary: #16161a;
      --bg-card: #1a1a1f;
      --bg-card-hover: #222228;
      --border: #27272a;
      --border-hover: #3f3f46;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-green: #10b981;
      --accent-green-bright: #34d399;
      --accent-green-dim: rgba(16, 185, 129, 0.12);
      --accent-green-glow: rgba(16, 185, 129, 0.4);
      --accent-yellow: #f59e0b;
      --accent-yellow-bright: #fbbf24;
      --accent-yellow-dim: rgba(245, 158, 11, 0.12);
      --accent-yellow-glow: rgba(245, 158, 11, 0.4);
      --accent-red: #ef4444;
      --accent-red-bright: #f87171;
      --accent-red-dim: rgba(239, 68, 68, 0.12);
      --accent-red-glow: rgba(239, 68, 68, 0.4);
      --accent-blue: #3b82f6;
      --accent-blue-bright: #60a5fa;
      --accent-blue-dim: rgba(59, 130, 246, 0.12);
      --accent-blue-glow: rgba(59, 130, 246, 0.4);
      --accent-gray: #52525b;
      --accent-gray-dim: rgba(82, 82, 91, 0.15);
      --font-mono: 'JetBrains Mono', monospace;
      --font-sans: 'IBM Plex Sans', -apple-system, sans-serif;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.4);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.5);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.6);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; }
    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      opacity: 0.02;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      z-index: 1000;
    }
    #root { min-height: 100vh; position: relative; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .delay-1 { animation-delay: 0.05s; opacity: 0; }
    .delay-2 { animation-delay: 0.1s; opacity: 0; }
    .delay-3 { animation-delay: 0.15s; opacity: 0; }
    .delay-4 { animation-delay: 0.2s; opacity: 0; }
    @media (max-width: 1024px) { html { font-size: 15px; } }
    @media (max-width: 768px) { html { font-size: 14px; } }
    @media (max-width: 480px) { html { font-size: 13px; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const tmcData = {
      lastUpdated: "2026-01-19",
      systemStatus: { daysSinceChange: 4, monitoringActive: true },
      bindingConstraint: {
        id: "noaa-permit", name: "NOAA Domestic Permit", status: "pending",
        risk: "medium", lastChange: "2026-01-15", changeDescription: "Comment period extended"
      },
      nextMilestone: { name: "Comment Period Closes", date: "2026-02-12", type: "deadline", relevantGate: "noaa-permit" },
      gates: [
        { id: "noaa-permit", name: "NOAA Domestic Permit", shortName: "NOAA Permit", state: "pending", blocking: true, riskLevel: "medium", earliestPossible: "2026-02-12", nextKnownEvent: "Comment period closes Feb 12", lastChange: "2026-01-15", interpretation: "Core binding constraint. NOAA must approve deep-sea mining permit under DSHMRA. Comment period currently open with active opposition from environmental groups. Decision expected 30-60 days after comment period closes, assuming no litigation delays.", position: 0, details: { agency: "NOAA / Dept. of Commerce", statute: "Deep Seabed Hard Mineral Resources Act", applicationDate: "2025-08-14", publicComments: 847 } },
        { id: "eis-clearance", name: "Environmental Impact Statement", shortName: "EIS Clearance", state: "pending", blocking: false, riskLevel: "low", earliestPossible: "2026-03-01", nextKnownEvent: "Final EIS under review", lastChange: "2025-12-18", interpretation: "Final EIS submitted and under agency review. No material objections raised in preliminary assessment. This gate is dependent on NOAA permit process and will likely clear shortly after permit approval.", position: 1, details: { agency: "NOAA / EPA", statute: "National Environmental Policy Act", draftCompleted: "2025-09-22", publicHearings: 3 } },
        { id: "litigation", name: "Litigation / Injunction Risk", shortName: "Litigation", state: "at-risk", blocking: false, riskLevel: "high", earliestPossible: "2026-02-18", nextKnownEvent: "Court hearing Feb 18 (CBD injunction motion)", lastChange: "2026-01-08", interpretation: "Center for Biological Diversity filed injunction motion Jan 8. Hearing scheduled Feb 18. Similar motions in this district denied ~60-70% historically, but current judge has mixed record on environmental cases. Risk concentrated in next 4-6 weeks.", position: 2, details: { court: "U.S. District Court, N.D. California", judge: "Hon. Sarah Chen", caseNumber: "3:26-cv-00142", plaintiff: "Center for Biological Diversity" } },
        { id: "isa-regs", name: "ISA Exploitation Regulations", shortName: "ISA Regs", state: "inactive", blocking: false, riskLevel: "low", earliestPossible: "2027-Q2", nextKnownEvent: "ISA Council meeting July 2026", lastChange: "2025-11-30", interpretation: "International Seabed Authority exploitation code still in development. Currently non-binding for TMC's domestic operations under DSHMRA. Will become relevant only after domestic permits secured. Not a near-term constraint.", position: 3, details: { body: "International Seabed Authority", location: "Kingston, Jamaica", memberStates: 168, nextSession: "July 2026" } },
        { id: "commercial-start", name: "Commercial Operations", shortName: "Commercial", state: "inactive", blocking: false, riskLevel: "low", earliestPossible: "2027-H1", nextKnownEvent: "Dependent on prior gates", lastChange: null, interpretation: "Final gate representing commercial-scale nodule collection. Timing entirely dependent on resolution of upstream permits and litigation. Vessel and processing infrastructure preparation ongoing in parallel.", position: 4, details: { vessel: "Hidden Gem (converted drillship)", processingPartner: "Pending finalization", targetVolume: "1.3M tonnes/year", offtakeAgreements: "In negotiation" } }
      ],
      riskModifiers: [
        { id: "dod-support", name: "DoD / Navy Support", targetGate: "noaa-permit", effect: "positive", strength: "medium", state: "active", interpretation: "DoD submitted supportive comment letter Jan 12 citing strategic mineral security. Historically, DoD support correlates with higher permit approval rates for strategic resources.", detail: "Letter emphasized cobalt, nickel, and manganese as critical minerals for defense applications." },
        { id: "political-pressure", name: "Political Alignment", targetGate: "noaa-permit", effect: "mixed", strength: "medium", state: "active", interpretation: "Current administration has mixed signals on deep-sea mining. Commerce Dept. favorable; EPA and some congressional members opposed. Net effect uncertain but not actively blocking.", detail: "Key swing votes in Senate Commerce Committee remain uncommitted." },
        { id: "ngo-opposition", name: "NGO Opposition", targetGate: "litigation", effect: "negative", strength: "high", state: "active", interpretation: "Coalition of 12 environmental groups actively opposing. CBD leading litigation effort. Greenpeace conducting public awareness campaign. Creates sustained pressure but legal standing for injunction is weak.", detail: "Coalition includes CBD, Greenpeace, Ocean Conservancy, and 9 others." }
      ],
      openRisks: [
        { id: "risk-1", title: "CBD Injunction Motion Pending", severity: "high", affectsGate: "litigation", gateIsBinding: false, description: "Motion for preliminary injunction filed Jan 8. If granted, would delay all permit activity until full trial.", nextAction: "Court hearing Feb 18", daysUntil: 30 },
        { id: "risk-2", title: "Comment Period Open", severity: "medium", affectsGate: "noaa-permit", gateIsBinding: true, description: "Public comment period accepting submissions. High volume of opposition comments expected but legally non-determinative.", nextAction: "Closes Feb 12", daysUntil: 24 },
        { id: "risk-3", title: "EPA Consultation Pending", severity: "low", affectsGate: "eis-clearance", gateIsBinding: false, description: "EPA requested additional consultation on certain EIS findings. Routine process, not expected to materially delay.", nextAction: "Response due Feb 28", daysUntil: 40 }
      ],
      recentChanges: [
        { id: "change-1", date: "2026-01-15", type: "neutral", title: "Comment period extended 14 days", description: "NOAA extended comment period to Feb 12 following procedural request. Minor delay, no material impact on outcome probability.", affectsGate: "noaa-permit" },
        { id: "change-2", date: "2026-01-12", type: "positive", title: "DoD support letter filed", description: "Department of Defense submitted formal comment supporting permit approval, citing critical mineral supply chain security.", affectsGate: "noaa-permit" },
        { id: "change-3", date: "2026-01-08", type: "negative", title: "CBD files injunction motion", description: "Center for Biological Diversity filed motion for preliminary injunction in federal court. Hearing scheduled Feb 18.", affectsGate: "litigation" },
        { id: "change-4", date: "2025-12-18", type: "positive", title: "Final EIS submitted", description: "TMC submitted final Environmental Impact Statement to NOAA. Agency review initiated.", affectsGate: "eis-clearance" }
      ]
    };

    const getStatusColor = (state) => ({ approved: 'var(--accent-green)', pending: 'var(--accent-yellow)', 'at-risk': 'var(--accent-red)', denied: 'var(--accent-red)', delayed: 'var(--accent-yellow)', inactive: 'var(--accent-gray)' }[state] || 'var(--accent-gray)');
    const getStatusBg = (state) => ({ approved: 'var(--accent-green-dim)', pending: 'var(--accent-yellow-dim)', 'at-risk': 'var(--accent-red-dim)', denied: 'var(--accent-red-dim)', delayed: 'var(--accent-yellow-dim)', inactive: 'var(--accent-gray-dim)' }[state] || 'var(--accent-gray-dim)');
    const getRiskColor = (level) => ({ high: 'var(--accent-red)', medium: 'var(--accent-yellow)', low: 'var(--accent-green)' }[level] || 'var(--accent-gray)');
    const getEffectColor = (effect) => ({ positive: 'var(--accent-green)', negative: 'var(--accent-red)', mixed: 'var(--accent-yellow)' }[effect] || 'var(--accent-gray)');
    const getChangeColor = (type) => ({ positive: 'var(--accent-green)', negative: 'var(--accent-red)', neutral: 'var(--accent-yellow)' }[type] || 'var(--accent-gray)');
    const formatDate = (dateStr) => { if (!dateStr) return 'TBD'; return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); };
    const getDaysUntil = (dateStr) => Math.ceil((new Date(dateStr) - new Date()) / (1000 * 60 * 60 * 24));
    const getUrgencyColor = (days) => days <= 7 ? 'var(--accent-red)' : days <= 21 ? 'var(--accent-yellow)' : 'var(--accent-blue)';

    const Tooltip = ({ children, content }) => {
      const [show, setShow] = useState(false);
      const [pos, setPos] = useState({ x: 0, y: 0 });
      const ref = useRef(null);
      const handleEnter = () => { const r = ref.current.getBoundingClientRect(); setPos({ x: r.left + r.width / 2, y: r.top }); setShow(true); };
      return (
        <div ref={ref} onMouseEnter={handleEnter} onMouseLeave={() => setShow(false)} style={{ position: 'relative', display: 'inline-block' }}>
          {children}
          {show && <div style={{ position: 'fixed', left: pos.x, top: pos.y - 8, transform: 'translateX(-50%) translateY(-100%)', background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '8px', padding: '10px 14px', fontSize: '13px', color: 'var(--text-secondary)', maxWidth: '280px', zIndex: 1000, boxShadow: 'var(--shadow-lg)' }}>{content}</div>}
        </div>
      );
    };

    const Header = () => (
      <header style={{ padding: '20px 24px', borderBottom: '1px solid var(--border)', background: 'linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%)', position: 'sticky', top: 0, zIndex: 100 }}>
        <div style={{ maxWidth: '1400px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '16px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '14px' }}>
            <div style={{ width: '12px', height: '12px', borderRadius: '50%', background: 'var(--accent-green)', boxShadow: '0 0 12px var(--accent-green-glow), 0 0 24px var(--accent-green-glow)' }} className="animate-pulse" />
            <div>
              <h1 style={{ fontFamily: 'var(--font-mono)', fontSize: '1.15rem', fontWeight: 700, letterSpacing: '-0.5px' }}>TMC APPROVAL STATE MAP</h1>
              <p style={{ color: 'var(--text-muted)', fontSize: '0.75rem', fontFamily: 'var(--font-mono)', marginTop: '2px' }}>Live regulatory intelligence ‚Ä¢ The Metals Company</p>
            </div>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '20px', fontSize: '0.8rem', color: 'var(--text-secondary)' }}>
            <div style={{ textAlign: 'right' }}>
              <div style={{ color: 'var(--text-muted)', fontFamily: 'var(--font-mono)', fontSize: '0.65rem', textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '2px' }}>Last Updated</div>
              <div style={{ fontFamily: 'var(--font-mono)', fontWeight: 500 }}>{formatDate(tmcData.lastUpdated)}</div>
            </div>
            <div style={{ width: '1px', height: '32px', background: 'var(--border)' }} />
            <div style={{ textAlign: 'right' }}>
              <div style={{ color: 'var(--text-muted)', fontFamily: 'var(--font-mono)', fontSize: '0.65rem', textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '2px' }}>Status</div>
              <div style={{ fontFamily: 'var(--font-mono)', color: 'var(--accent-green)', fontWeight: 500, display: 'flex', alignItems: 'center', gap: '6px', justifyContent: 'flex-end' }}>
                <span style={{ width: '6px', height: '6px', borderRadius: '50%', background: 'var(--accent-green)' }} />Active
              </div>
            </div>
          </div>
        </div>
      </header>
    );

    const SystemSummary = () => {
      const daysUntilMilestone = getDaysUntil(tmcData.nextMilestone.date);
      return (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px', marginBottom: '24px' }} className="animate-fade-in delay-1">
          <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '16px', padding: '20px 24px', borderLeft: '4px solid ' + getStatusColor(tmcData.bindingConstraint.status) }}>
            <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '12px' }}>‚è± Current Binding Constraint</div>
            <div style={{ fontSize: '1.2rem', fontWeight: 700, marginBottom: '12px' }}>{tmcData.bindingConstraint.name}</div>
            <div style={{ display: 'flex', gap: '10px', marginBottom: '14px', flexWrap: 'wrap' }}>
              <span style={{ padding: '5px 12px', borderRadius: '6px', fontSize: '0.7rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: getStatusBg(tmcData.bindingConstraint.status), color: getStatusColor(tmcData.bindingConstraint.status), textTransform: 'uppercase' }}>{tmcData.bindingConstraint.status}</span>
              <span style={{ padding: '5px 12px', borderRadius: '6px', fontSize: '0.7rem', fontFamily: 'var(--font-mono)', fontWeight: 500, background: 'var(--bg-tertiary)', color: getRiskColor(tmcData.bindingConstraint.risk) }}>Risk: {tmcData.bindingConstraint.risk}</span>
            </div>
            <div style={{ fontSize: '0.8rem', color: 'var(--text-muted)' }}>Last change: {formatDate(tmcData.bindingConstraint.lastChange)}</div>
          </div>
          <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '16px', padding: '20px 24px' }}>
            <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '12px' }}>üìä System Status</div>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: '8px', marginBottom: '4px' }}>
              <span style={{ fontSize: '2.5rem', fontWeight: 700, fontFamily: 'var(--font-mono)', lineHeight: 1 }}>{tmcData.systemStatus.daysSinceChange}</span>
              <span style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>days</span>
            </div>
            <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', marginBottom: '16px' }}>since material change</div>
            <div style={{ padding: '12px 14px', background: 'rgba(16, 185, 129, 0.08)', borderRadius: '10px', fontSize: '0.8rem', color: 'var(--text-secondary)', border: '1px solid rgba(16, 185, 129, 0.15)' }}>
              <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--accent-green)', display: 'inline-block', marginRight: '8px' }} className="animate-pulse" />All systems nominal.
            </div>
          </div>
          <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '16px', padding: '20px 24px', borderLeft: '4px solid var(--accent-blue)' }}>
            <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '12px' }}>üìÖ Next Known Milestone</div>
            <div style={{ fontSize: '1.1rem', fontWeight: 700, marginBottom: '12px' }}>{tmcData.nextMilestone.name}</div>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: '8px', marginBottom: '8px' }}>
              <span style={{ fontSize: '2.2rem', fontWeight: 700, fontFamily: 'var(--font-mono)', color: getUrgencyColor(daysUntilMilestone), lineHeight: 1 }}>{daysUntilMilestone}</span>
              <span style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>days remaining</span>
            </div>
            <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', fontFamily: 'var(--font-mono)' }}>{formatDate(tmcData.nextMilestone.date)}</div>
          </div>
        </div>
      );
    };

    const GateNode = ({ gate, isSelected, onClick, isLast, isMobile }) => {
      const [hovered, setHovered] = useState(false);
      const modifiers = tmcData.riskModifiers.filter(m => m.targetGate === gate.id);
      const isActive = gate.state !== 'inactive';
      return (
        <div style={{ display: 'flex', alignItems: isMobile ? 'stretch' : 'center', flexDirection: isMobile ? 'column' : 'row' }}>
          <div onClick={() => onClick(gate)} onMouseEnter={() => setHovered(true)} onMouseLeave={() => setHovered(false)}
            style={{ background: isSelected ? 'var(--bg-tertiary)' : hovered ? 'var(--bg-card-hover)' : 'var(--bg-card)', border: '2px solid ' + (isSelected || hovered ? getStatusColor(gate.state) : 'var(--border)'), borderRadius: '14px', padding: gate.blocking ? '28px 20px 18px' : '18px 20px', minWidth: isMobile ? 'auto' : '150px', width: isMobile ? '100%' : 'auto', cursor: 'pointer', transition: 'all 0.25s ease', position: 'relative', opacity: isActive ? 1 : 0.5, transform: hovered && isActive ? 'translateY(-4px)' : 'translateY(0)', boxShadow: hovered && isActive ? 'var(--shadow-lg)' : 'var(--shadow-sm)' }}>
            {gate.blocking && <div style={{ position: 'absolute', top: '-10px', left: '50%', transform: 'translateX(-50%)', background: 'linear-gradient(135deg, var(--accent-red) 0%, #dc2626 100%)', color: 'white', fontSize: '0.6rem', fontFamily: 'var(--font-mono)', fontWeight: 700, padding: '4px 10px', borderRadius: '6px', textTransform: 'uppercase', letterSpacing: '1px', whiteSpace: 'nowrap' }}>‚ö° Blocking</div>}
            <div style={{ width: '14px', height: '14px', borderRadius: '50%', background: getStatusColor(gate.state), marginBottom: '12px', boxShadow: isActive ? '0 0 12px ' + getStatusColor(gate.state) : 'none' }} />
            <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.85rem', fontWeight: 600, marginBottom: '10px' }}>{gate.shortName}</div>
            <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
              <span style={{ padding: '3px 8px', borderRadius: '5px', fontSize: '0.65rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: getStatusBg(gate.state), color: getStatusColor(gate.state), textTransform: 'uppercase' }}>{gate.state}</span>
              {isActive && <span style={{ padding: '3px 8px', borderRadius: '5px', fontSize: '0.65rem', fontFamily: 'var(--font-mono)', fontWeight: 500, background: 'var(--bg-tertiary)', color: getRiskColor(gate.riskLevel) }}>{gate.riskLevel}</span>}
            </div>
            {modifiers.length > 0 && <div style={{ position: 'absolute', bottom: '-20px', left: '50%', transform: 'translateX(-50%)', display: 'flex', gap: '6px', background: 'var(--bg-primary)', padding: '4px 8px', borderRadius: '12px', border: '1px solid var(--border)' }}>
              {modifiers.map(m => <Tooltip key={m.id} content={m.name + ' (' + m.effect + ')'}><div style={{ width: '10px', height: '10px', borderRadius: '50%', background: getEffectColor(m.effect), cursor: 'help' }} /></Tooltip>)}
            </div>}
            {hovered && isActive && <div style={{ position: 'absolute', bottom: modifiers.length > 0 ? '-44px' : '-28px', left: '50%', transform: 'translateX(-50%)', fontSize: '0.65rem', color: 'var(--text-muted)', whiteSpace: 'nowrap', fontFamily: 'var(--font-mono)' }}>Click for details ‚Üí</div>}
          </div>
          {!isLast && <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', padding: isMobile ? '12px 0' : '0 6px' }}>
            {isMobile ? <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={gate.state === 'approved' ? 'var(--accent-green)' : 'var(--border)'} strokeWidth="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
            : <div style={{ width: '32px', height: '2px', background: gate.state === 'approved' ? 'var(--accent-green)' : 'var(--border)', position: 'relative' }}><div style={{ position: 'absolute', right: '-5px', top: '-5px', width: 0, height: 0, borderTop: '6px solid transparent', borderBottom: '6px solid transparent', borderLeft: '10px solid ' + (gate.state === 'approved' ? 'var(--accent-green)' : 'var(--border)') }} /></div>}
          </div>}
        </div>
      );
    };

    const ApprovalGraph = ({ selectedGate, onSelectGate }) => {
      const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
      useEffect(() => { const h = () => setIsMobile(window.innerWidth < 768); window.addEventListener('resize', h); return () => window.removeEventListener('resize', h); }, []);
      return (
        <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '20px', padding: '24px', marginBottom: '24px' }} className="animate-fade-in delay-2">
          <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '24px', display: 'flex', justifyContent: 'space-between' }}>
            <span>üìà Approval Critical Path</span>
            <span style={{ fontWeight: 400, fontSize: '0.6rem' }}>Click any node for details</span>
          </div>
          <div style={{ display: 'flex', flexDirection: isMobile ? 'column' : 'row', alignItems: isMobile ? 'stretch' : 'flex-start', justifyContent: 'center', padding: isMobile ? '8px 0 24px' : '24px 0 48px' }}>
            {tmcData.gates.map((gate, idx) => <GateNode key={gate.id} gate={gate} isSelected={selectedGate?.id === gate.id} onClick={onSelectGate} isLast={idx === tmcData.gates.length - 1} isMobile={isMobile} />)}
          </div>
          <div style={{ borderTop: '1px solid var(--border)', paddingTop: '20px', marginTop: '8px' }}>
            <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '14px' }}>üõ° Active Risk Modifiers</div>
            <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
              {tmcData.riskModifiers.map(mod => <Tooltip key={mod.id} content={mod.interpretation}><div style={{ display: 'flex', alignItems: 'center', gap: '10px', padding: '10px 14px', background: 'var(--bg-tertiary)', borderRadius: '10px', fontSize: '0.8rem', cursor: 'help', transition: 'all 0.2s ease' }}>
                <div style={{ width: '10px', height: '10px', borderRadius: '50%', background: getEffectColor(mod.effect) }} />
                <span style={{ color: 'var(--text-secondary)' }}>{mod.name}</span>
                <span style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)' }}>‚Üí {tmcData.gates.find(g => g.id === mod.targetGate)?.shortName}</span>
              </div></Tooltip>)}
            </div>
          </div>
        </div>
      );
    };

    const GateDetailPanel = ({ gate, onClose }) => {
      const [visible, setVisible] = useState(false);
      useEffect(() => { if (gate) setVisible(true); }, [gate]);
      const handleClose = () => { setVisible(false); setTimeout(onClose, 200); };
      if (!gate) return null;
      const modifiers = tmcData.riskModifiers.filter(m => m.targetGate === gate.id);
      const risks = tmcData.openRisks.filter(r => r.affectsGate === gate.id);
      const isMobile = window.innerWidth < 768;
      return (
        <>
          <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.6)', backdropFilter: 'blur(4px)', zIndex: 150, opacity: visible ? 1 : 0, transition: 'opacity 0.2s ease' }} onClick={handleClose} />
          <div style={{ position: 'fixed', top: 0, right: 0, width: isMobile ? '100%' : '500px', maxWidth: '100%', height: '100vh', background: 'linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%)', borderLeft: isMobile ? 'none' : '1px solid var(--border)', padding: '28px', overflowY: 'auto', zIndex: 200, transform: visible ? 'translateX(0)' : 'translateX(100%)', transition: 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)' }}>
            <button onClick={handleClose} style={{ position: 'sticky', top: 0, float: 'right', background: 'var(--bg-tertiary)', border: '1px solid var(--border)', borderRadius: '10px', padding: '10px 16px', color: 'var(--text-secondary)', cursor: 'pointer', fontFamily: 'var(--font-mono)', fontSize: '0.8rem', zIndex: 10 }}>‚úï Close</button>
            <div style={{ clear: 'both', paddingTop: '8px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '14px', marginBottom: '20px' }}>
                <div style={{ width: '20px', height: '20px', borderRadius: '50%', background: getStatusColor(gate.state), boxShadow: '0 0 16px ' + getStatusColor(gate.state) }} />
                <h2 style={{ fontSize: '1.4rem', fontWeight: 700 }}>{gate.name}</h2>
              </div>
              <div style={{ display: 'flex', gap: '10px', marginBottom: '24px', flexWrap: 'wrap' }}>
                <span style={{ padding: '8px 14px', borderRadius: '8px', fontSize: '0.75rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: getStatusBg(gate.state), color: getStatusColor(gate.state), textTransform: 'uppercase' }}>{gate.state}</span>
                {gate.blocking && <span style={{ padding: '8px 14px', borderRadius: '8px', fontSize: '0.75rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: 'var(--accent-red-dim)', color: 'var(--accent-red)', textTransform: 'uppercase' }}>‚ö° Blocking</span>}
                <span style={{ padding: '8px 14px', borderRadius: '8px', fontSize: '0.75rem', fontFamily: 'var(--font-mono)', fontWeight: 500, background: 'var(--bg-tertiary)', color: getRiskColor(gate.riskLevel) }}>Risk: {gate.riskLevel}</span>
              </div>
              <div style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', padding: '20px', marginBottom: '20px' }}>
                <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '12px' }}>üìÑ Analysis</div>
                <p style={{ fontSize: '0.9rem', color: 'var(--text-secondary)', lineHeight: '1.8' }}>{gate.interpretation}</p>
              </div>
              {gate.details && <div style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', padding: '20px', marginBottom: '20px' }}>
                <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '14px' }}>Key Details</div>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px' }}>
                  {Object.entries(gate.details).map(([key, value]) => <div key={key} style={{ padding: '10px 12px', background: 'var(--bg-tertiary)', borderRadius: '8px' }}>
                    <div style={{ fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'capitalize', marginBottom: '4px' }}>{key.replace(/([A-Z])/g, ' $1').trim()}</div>
                    <div style={{ fontSize: '0.85rem', color: 'var(--text-primary)', fontWeight: 500 }}>{value}</div>
                  </div>)}
                </div>
              </div>}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '20px' }}>
                <div style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', padding: '16px' }}>
                  <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '8px' }}>Earliest Possible</div>
                  <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.95rem', fontWeight: 600 }}>{gate.earliestPossible}</div>
                </div>
                <div style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', padding: '16px' }}>
                  <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '8px' }}>Last Change</div>
                  <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.95rem', fontWeight: 600 }}>{gate.lastChange ? formatDate(gate.lastChange) : 'N/A'}</div>
                </div>
              </div>
              <div style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderLeft: '4px solid var(--accent-blue)', borderRadius: '12px', padding: '18px', marginBottom: '20px' }}>
                <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', marginBottom: '8px' }}>‚è∞ Next Known Event</div>
                <div style={{ fontSize: '0.95rem', fontWeight: 500 }}>{gate.nextKnownEvent}</div>
              </div>
              {modifiers.length > 0 && <div style={{ marginBottom: '20px' }}>
                <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '14px' }}>üõ° Risk Modifiers ({modifiers.length})</div>
                {modifiers.map(mod => <div key={mod.id} style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '12px', padding: '18px', marginBottom: '10px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
                    <div style={{ width: '12px', height: '12px', borderRadius: '50%', background: getEffectColor(mod.effect) }} />
                    <span style={{ fontWeight: 600, fontSize: '0.95rem' }}>{mod.name}</span>
                    <span style={{ padding: '4px 10px', borderRadius: '6px', fontSize: '0.65rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: 'var(--bg-tertiary)', color: getEffectColor(mod.effect), textTransform: 'uppercase' }}>{mod.effect}</span>
                  </div>
                  <p style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', lineHeight: '1.7', marginBottom: '8px' }}>{mod.interpretation}</p>
                  {mod.detail && <p style={{ fontSize: '0.8rem', color: 'var(--text-muted)', fontStyle: 'italic', paddingTop: '8px', borderTop: '1px solid var(--border)' }}>{mod.detail}</p>}
                </div>)}
              </div>}
              {risks.length > 0 && <div>
                <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.6rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '14px' }}>‚ö†Ô∏è Open Risks ({risks.length})</div>
                {risks.map(risk => <div key={risk.id} style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderLeft: '4px solid ' + getRiskColor(risk.severity), borderRadius: '12px', padding: '18px', marginBottom: '10px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '10px', flexWrap: 'wrap', gap: '8px' }}>
                    <span style={{ fontWeight: 600, fontSize: '0.95rem' }}>{risk.title}</span>
                    <span style={{ padding: '4px 10px', borderRadius: '6px', fontSize: '0.65rem', fontFamily: 'var(--font-mono)', fontWeight: 600, background: 'var(--bg-tertiary)', color: getRiskColor(risk.severity), textTransform: 'uppercase' }}>{risk.severity}</span>
                  </div>
                  <p style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', marginBottom: '12px', lineHeight: '1.7' }}>{risk.description}</p>
                  <div style={{ fontSize: '0.8rem', fontFamily: 'var(--font-mono)', color: 'var(--accent-blue)', fontWeight: 500 }}>‚Üí {risk.nextAction}</div>
                </div>)}
              </div>}
            </div>
          </div>
        </>
      );
    };

    const OpenRisks = () => (
      <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '20px', padding: '24px', height: '100%' }} className="animate-fade-in delay-3">
        <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '10px' }}>
          <div style={{ width: '10px', height: '10px', borderRadius: '50%', background: 'var(--accent-red)' }} className="animate-pulse" />Open Risks ({tmcData.openRisks.length})
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
          {tmcData.openRisks.map(risk => {
            const gate = tmcData.gates.find(g => g.id === risk.affectsGate);
            return (
              <div key={risk.id} style={{ padding: '18px', background: 'var(--bg-tertiary)', borderRadius: '14px', borderLeft: '4px solid ' + getRiskColor(risk.severity) }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '10px', gap: '12px', flexWrap: 'wrap' }}>
                  <div style={{ fontWeight: 600, fontSize: '0.95rem', flex: 1, minWidth: '150px' }}>{risk.title}</div>
                  <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                    <span style={{ padding: '4px 10px', background: 'var(--bg-card)', borderRadius: '6px', fontSize: '0.7rem', fontFamily: 'var(--font-mono)', color: getRiskColor(risk.severity), fontWeight: 600, textTransform: 'uppercase' }}>{risk.severity}</span>
                    <span style={{ padding: '4px 10px', background: 'var(--bg-card)', borderRadius: '6px', fontSize: '0.7rem', fontFamily: 'var(--font-mono)', display: 'flex', alignItems: 'center', gap: '4px' }}>{gate?.shortName}{risk.gateIsBinding && <span style={{ color: 'var(--accent-red)', fontSize: '0.9rem' }}>‚óè</span>}</span>
                  </div>
                </div>
                <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', marginBottom: '12px', lineHeight: '1.6' }}>{risk.description}</div>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', paddingTop: '12px', borderTop: '1px solid var(--border)' }}>
                  <div style={{ fontSize: '0.8rem', fontFamily: 'var(--font-mono)', color: 'var(--accent-blue)', fontWeight: 500 }}>‚Üí {risk.nextAction}</div>
                  <div style={{ fontSize: '0.75rem', fontFamily: 'var(--font-mono)', color: getUrgencyColor(risk.daysUntil), fontWeight: 500 }}>{risk.daysUntil}d</div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );

    const RecentChanges = () => (
      <div style={{ background: 'linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%)', border: '1px solid var(--border)', borderRadius: '20px', padding: '24px', height: '100%' }} className="animate-fade-in delay-4">
        <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.65rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1.5px', marginBottom: '20px', display: 'flex', justifyContent: 'space-between' }}>
          <span>üîÑ Recent Material Changes</span>
          <span style={{ fontWeight: 400, fontSize: '0.6rem' }}>Last 30 days</span>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column' }}>
          {tmcData.recentChanges.map((change, idx) => {
            const gate = tmcData.gates.find(g => g.id === change.affectsGate);
            return (
              <div key={change.id} style={{ display: 'flex', gap: '16px', padding: '16px 0', borderTop: idx === 0 ? 'none' : '1px solid var(--border)' }}>
                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '12px', height: '12px', borderRadius: '50%', background: getChangeColor(change.type), flexShrink: 0 }} />
                  {idx < tmcData.recentChanges.length - 1 && <div style={{ width: '2px', flex: 1, background: 'var(--border)', borderRadius: '1px' }} />}
                </div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '6px', gap: '12px', flexWrap: 'wrap' }}>
                    <span style={{ fontWeight: 600, fontSize: '0.9rem', lineHeight: '1.4' }}>{change.title}</span>
                    <span style={{ padding: '3px 8px', background: 'var(--bg-tertiary)', borderRadius: '5px', fontSize: '0.65rem', fontFamily: 'var(--font-mono)', color: 'var(--text-muted)', flexShrink: 0 }}>{gate?.shortName}</span>
                  </div>
                  <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)', marginBottom: '8px', lineHeight: '1.6' }}>{change.description}</div>
                  <div style={{ fontFamily: 'var(--font-mono)', fontSize: '0.75rem', color: 'var(--text-muted)' }}>{formatDate(change.date)}</div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );

    const App = () => {
      const [selectedGate, setSelectedGate] = useState(null);
      const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);
      useEffect(() => { const h = () => setIsMobile(window.innerWidth < 1024); window.addEventListener('resize', h); return () => window.removeEventListener('resize', h); }, []);
      return (
        <div style={{ minHeight: '100vh', background: 'var(--bg-primary)' }}>
          <Header />
          <main style={{ maxWidth: '1400px', margin: '0 auto', padding: isMobile ? '20px 16px' : '28px 32px' }}>
            <SystemSummary />
            <ApprovalGraph selectedGate={selectedGate} onSelectGate={setSelectedGate} />
            <div style={{ display: 'grid', gridTemplateColumns: isMobile ? '1fr' : 'repeat(2, 1fr)', gap: '20px' }}>
              <OpenRisks />
              <RecentChanges />
            </div>
          </main>
          {selectedGate && <GateDetailPanel gate={selectedGate} onClose={() => setSelectedGate(null)} />}
          <footer style={{ borderTop: '1px solid var(--border)', padding: '24px 32px', marginTop: '48px', background: 'var(--bg-secondary)' }}>
            <div style={{ maxWidth: '1400px', margin: '0 auto', display: 'flex', flexDirection: isMobile ? 'column' : 'row', justifyContent: 'space-between', alignItems: isMobile ? 'flex-start' : 'center', gap: '12px', fontSize: '0.75rem', color: 'var(--text-muted)', fontFamily: 'var(--font-mono)' }}>
              <div>TMC Approval State Map ‚Ä¢ For informational purposes only ‚Ä¢ Not financial advice</div>
              <div>Data manually curated ‚Ä¢ Last verified: {formatDate(tmcData.lastUpdated)}</div>
            </div>
          </footer>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
